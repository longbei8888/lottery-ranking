# .github/workflows/manual-update.yml
# æ‰‹å‹•æ›´æ–°å·¥ä½œæµç¨‹ï¼ˆé©ç”¨æ–¼ç·Šæ€¥æ›´æ–°ï¼‰

name: æ‰‹å‹•æ›´æ–°æ’å

on:
  workflow_dispatch:
    inputs:
      force_update:
        description: 'å¼·åˆ¶æ›´æ–°ï¼ˆå³ä½¿æ²’æœ‰æª”æ¡ˆè®Šæ›´ï¼‰'
        required: false
        default: false
        type: boolean
      message:
        description: 'æ›´æ–°è¨Šæ¯'
        required: false
        default: 'æ‰‹å‹•æ›´æ–°æ’åæ•¸æ“š'

jobs:
  manual-update:
    runs-on: ubuntu-latest
    
    steps:
      - name: æª¢å‡ºå€‰åº«
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: è¨­ç½® Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
      
      - name: å®‰è£ä¾è³´
        run: npm install xlsx
      
      - name: è™•ç†æ•¸æ“š
        run: node scripts/process-data.js excel_files data/ranking.json
      
      - name: æäº¤è®Šæ›´
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/ranking.json
          git commit -m "ğŸ¯ ${{ github.event.inputs.message }} - $(date +'%Y-%m-%d %H:%M:%S')" || echo "ç„¡è®Šæ›´éœ€è¦æäº¤"
          git push || echo "ç„¡è®Šæ›´éœ€è¦æ¨é€"
      
      - name: éƒ¨ç½²åˆ° GitHub Pages
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./
          publish_branch: gh-pages